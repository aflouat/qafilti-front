<p-tabs [value]="activeTab()">
  <p-tablist>
    <p-tab [value]="0" label="Bus"></p-tab>
    <p-tab [value]="1" label="Villes"></p-tab>
    <p-tab [value]="2" label="Trips"></p-tab>
    <p-tab [value]="3" label="Trajets"></p-tab>
    <p-tab [value]="4" label="Tarifs"></p-tab>
  </p-tablist>
  <p-tabpanels>
    <!-- Bus Tab -->
    <p-tabpanel [value]="0">
      <div class="flex justify-content-between align-items-center mb-2">
        <h3 class="m-0">Bus</h3>
        <button pButton label="Ajouter" (click)="openBus()"></button>
      </div>
      <p-table [value]="buses()" [paginator]="true" [rows]="10">
        <ng-template pTemplate="header">
          <tr><th>ID</th><th>Immatriculation</th><th>Statut</th><th>Capacité</th><th>Actions</th></tr>
        </ng-template>
        <ng-template pTemplate="body" let-b>
          <tr>
            <td>{{ b.id }}</td>
            <td>{{ b.license_plate }}</td>
            <td>{{ b.status }}</td>
            <td>{{ b.capacity }}</td>
            <td>
              <button pButton icon="pi pi-pencil" (click)="editBus(b)"></button>
              <button pButton icon="pi pi-times" severity="danger" (click)="removeBus(b)"></button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-tabpanel>

    <!-- Cities Tab -->
    <p-tabpanel [value]="1">
      <div class="flex justify-content-between align-items-center mb-2">
        <h3 class="m-0">Villes</h3>
        <button pButton label="Ajouter" (click)="openCity()"></button>
      </div>
      <p-table [value]="cities()" [paginator]="true" [rows]="10">
        <ng-template pTemplate="header">
          <tr><th>ID</th><th>Nom (FR)</th><th>Nom (AR)</th><th>Actions</th></tr>
        </ng-template>
        <ng-template pTemplate="body" let-c>
          <tr>
            <td>{{ c.id }}</td>
            <td>{{ c.nameFr }}</td>
            <td>{{ c.nameAr }}</td>
            <td>
              <button pButton icon="pi pi-pencil" (click)="editCity(c)"></button>
              <button pButton icon="pi pi-times" severity="danger" (click)="removeCity(c)"></button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-tabpanel>

    <!-- Trips Tab -->
    <p-tabpanel [value]="2">
      <div class="flex justify-content-between align-items-center mb-2">
        <h3 class="m-0">Trips (Voyages)</h3>
        <button pButton label="Ajouter" (click)="openTrip()"></button>
      </div>
      <p-table [value]="trips()" [paginator]="true" [rows]="10">
        <ng-template pTemplate="header">
          <tr><th>ID</th><th>Date</th><th>Trajet</th><th>Départ</th><th>Arrivée</th><th>Bus</th><th>Heures</th><th>Capacité restante</th><th>Actions</th></tr>
        </ng-template>
        <ng-template pTemplate="body" let-t>
          <tr>
            <td>{{ t.tripId }}</td>
            <td>{{ t.date }}</td>
            <td>{{ t.trajetCode }}</td>
            <td>{{ t.departureCityName || t.departureCityId }}</td>
            <td>{{ t.arrivalCityName || t.arrivalCityId }}</td>
            <td>{{ t.vehicleId }}</td>
            <td>{{ t.departureTime }} - {{ t.arrivalTime }}</td>
            <td>{{ remainingCapacity(t) }}</td>
            <td>
              <button pButton icon="pi pi-pencil" (click)="editTrip(t)"></button>
              <button pButton icon="pi pi-times" severity="danger" (click)="removeTrip(t)"></button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-tabpanel>

    <!-- Trajets Tab -->
    <p-tabpanel [value]="3">
      <div class="flex justify-content-between align-items-center mb-2">
        <h3 class="m-0">Trajets</h3>
        <button pButton label="Ajouter" (click)="openTrajet()"></button>
      </div>
      <p-table [value]="trajets()" [paginator]="true" [rows]="10">
        <ng-template pTemplate="header">
          <tr><th>Code</th><th>Origine</th><th>Destination</th><th>Actions</th></tr>
        </ng-template>
        <ng-template pTemplate="body" let-t>
          <tr>
            <td>{{ t.code }}</td>
            <td>{{ t.origine }}</td>
            <td>{{ t.destination }}</td>
            <td>
              <button pButton icon="pi pi-pencil" (click)="editTrajet(t)"></button>
              <button pButton icon="pi pi-times" severity="danger" (click)="removeTrajet(t)"></button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-tabpanel>
    <p-tabpanel [value]="4">
      <div class="flex justify-content-between align-items-center mb-2">
        <h3 class="m-0">Tarifs</h3>
        <button pButton label="Ajouter" (click)="openTarif()"></button>
      </div>
      <p-table [value]="tarifs()" [paginator]="true" [rows]="10">
        <ng-template pTemplate="header">
          <tr><th>Trajet</th><th>Prix (MRU)</th><th>Actions</th></tr>
        </ng-template>
        <ng-template pTemplate="body" let-f>
          <tr>
            <td>{{ f.trajet }}</td>
            <td>{{ f.prix }}</td>
            <td>
              <button pButton icon="pi pi-pencil" (click)="editTarif(f)"></button>
              <button pButton icon="pi pi-times" severity="danger" (click)="removeTarif(f)"></button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-tabpanel>
  </p-tabpanels>
</p-tabs>

<!-- Dialogs -->
<p-dialog [(visible)]="trajetDialog" header="Trajet" [modal]="true" [style]="{width:'420px'}">
  <div class="flex flex-column gap-3">
    <div>
      <label class="block mb-1">Code</label>
      <input pInputText placeholder="Ex: TRJ001" [(ngModel)]="trajetForm.code" [style]="{width:'100%'}" />
    </div>
    <div>
      <label class="block mb-1">Ville d'origine</label>
      <p-select
        [options]="cityOptions()"
        [(ngModel)]="trajetForm.origine"
        placeholder="Sélectionner une ville"
        [style]="{width:'100%'}"
        optionLabel="label"
        optionValue="label"
        [filter]="true">
      </p-select>
    </div>
    <div>
      <label class="block mb-1">Ville de destination</label>
      <p-select
        [options]="cityOptions()"
        [(ngModel)]="trajetForm.destination"
        placeholder="Sélectionner une ville"
        [style]="{width:'100%'}"
        optionLabel="label"
        optionValue="label"
        [filter]="true">
      </p-select>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <button pButton label="Annuler" (click)="trajetDialog=false" text></button>
    <button pButton label="Enregistrer" (click)="saveTrajet()"></button>
  </ng-template>
</p-dialog>

<p-dialog [(visible)]="tarifDialog" header="Tarif" [modal]="true" [style]="{width:'420px'}">
  <div class="flex flex-column gap-2">
    <input pInputText placeholder="Trajet" [(ngModel)]="tarifForm.trajet" [style]="{width:'100%'}" />
    <input pInputText placeholder="Prix (MRU)" [(ngModel)]="tarifForm.prix" [style]="{width:'100%'}" />
  </div>
  <ng-template pTemplate="footer">
    <button pButton label="Annuler" (click)="tarifDialog=false" text></button>
    <button pButton label="Enregistrer" (click)="saveTarif()"></button>
  </ng-template>
</p-dialog>

<!-- Bus Dialog -->
<p-dialog [(visible)]="busDialog" header="Bus" [modal]="true" [style]="{width:'420px'}">
  <div class="flex flex-column gap-2">
    <input pInputText placeholder="Plaque d'immatriculation" [(ngModel)]="busForm.license_plate" [style]="{width:'100%'}" />
    <p-select [options]="busStatusOptions" optionLabel="label" optionValue="value" [(ngModel)]="busForm.status" placeholder="Statut" [style]="{width:'100%'}"></p-select>
    <input pInputText placeholder="Capacité" [(ngModel)]="busForm.capacity" type="number" [style]="{width:'100%'}" />
  </div>
  <ng-template pTemplate="footer">
    <button pButton label="Annuler" (click)="busDialog=false" text></button>
    <button pButton label="Enregistrer" (click)="saveBus()"></button>
  </ng-template>
</p-dialog>

<!-- City Dialog -->
<p-dialog [(visible)]="cityDialog" header="Ville" [modal]="true" [style]="{width:'420px'}">
  <div class="flex flex-column gap-2">
    <input pInputText placeholder="Nom en français" [(ngModel)]="cityForm.nameFr" [style]="{width:'100%'}" />
    <input pInputText placeholder="Nom en arabe" [(ngModel)]="cityForm.nameAr" dir="rtl" [style]="{width:'100%'}" />
  </div>
  <ng-template pTemplate="footer">
    <button pButton label="Annuler" (click)="cityDialog=false" text></button>
    <button pButton label="Enregistrer" (click)="saveCity()"></button>
  </ng-template>
</p-dialog>

<!-- Trip Dialog -->
<p-dialog [(visible)]="tripDialog" header="Trip (Voyage)" [modal]="true" [style]="{width:'500px'}">
  <div class="flex flex-column gap-3">
    <div>
      <label class="block mb-1">Date</label>
      <input pInputText type="date" [(ngModel)]="tripForm.date" [style]="{width:'100%'}" />
    </div>

    <div>
      <label class="block mb-1">Trajet</label>
      <p-select
        [options]="trajetOptions()"
        [(ngModel)]="tripForm.trajetCode"
        placeholder="Sélectionner un trajet"
        [style]="{width:'100%'}"
        optionLabel="label"
        optionValue="value"
        [filter]="true">
      </p-select>
    </div>

    <div>
      <label class="block mb-1">Ville de départ</label>
      <p-select
        [options]="cityOptions()"
        [(ngModel)]="tripForm.departureCityId"
        placeholder="Sélectionner une ville"
        [style]="{width:'100%'}"
        optionLabel="label"
        optionValue="value"
        [filter]="true">
      </p-select>
    </div>

    <div>
      <label class="block mb-1">Ville d'arrivée</label>
      <p-select
        [options]="cityOptions()"
        [(ngModel)]="tripForm.arrivalCityId"
        placeholder="Sélectionner une ville"
        [style]="{width:'100%'}"
        optionLabel="label"
        optionValue="value"
        [filter]="true">
      </p-select>
    </div>

    <div>
      <label class="block mb-1">Bus</label>
      <p-select
        [options]="busOptions()"
        [(ngModel)]="tripForm.vehicleId"
        placeholder="Sélectionner un bus"
        [style]="{width:'100%'}"
        optionLabel="label"
        optionValue="value"
        [filter]="true">
      </p-select>
    </div>

    <div class="grid">
      <div class="col-6">
        <label class="block mb-1">Heure départ</label>
        <input pInputText type="time" [(ngModel)]="tripForm.departureTime" [style]="{width:'100%'}" />
      </div>
      <div class="col-6">
        <label class="block mb-1">Heure arrivée</label>
        <input pInputText type="time" [(ngModel)]="tripForm.arrivalTime" [style]="{width:'100%'}" />
      </div>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <button pButton label="Annuler" (click)="tripDialog=false" text></button>
    <button pButton label="Enregistrer" (click)="saveTrip()"></button>
  </ng-template>
</p-dialog>
